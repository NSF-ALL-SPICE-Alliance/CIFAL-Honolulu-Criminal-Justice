---
title: "Vulnerability Index - Organized Crime"
author: "Andrew Nishitomi & Connor Flynn"
date: "2/1/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(janitor)
library(ggcorrplot)
```

```{r}
oc_index <- read_csv(here("data/global_oc_index_2021_sids_category.csv"))
```

```{r}
oc_index <- oc_index %>% 
  clean_names()
```


```{r}
oc_index_overall_score <- oc_index %>% 
  mutate(criminality_mean_score = rowMeans(across(c(criminality, criminal_markets, human_trafficking, human_smuggling, 
                                                  arms_trafficking, flora_crimes, fauna_crimes, non_renewable_resource_crimes,
                                                  heroin_trade, cocaine_trade, cannabis_trade, synthetic_drug_trade, criminal_actors,
                                                  mafia_style_groups, criminal_networks, state_embedded_actors, foreign_actors))))
```


```{r}
oc_index_overall_score <- oc_index_overall_score %>% 
  mutate(resillience_mean_score = rowMeans(across(c(political_leadership_and_governance, government_transparency_and_accountability,international_cooperation, national_policies_and_laws, judicial_system_and_detention, law_enforcement, territorial_integrity, anti_money_laundering, economic_regulatory_capacity, victim_and_witness_support, prevention, non_state_actors))))
```


```{r}
oc_index_overall_score <- oc_index_overall_score %>% 
  mutate(overall_score = resillience_mean_score - criminality_mean_score)
```



Histogram

```{r}
oc_index_longer <- oc_index %>% 
  pivot_longer(cols = criminality:non_state_actors, 
               names_to = "ranking", 
               values_to = "value")
```


```{r}
ggplot(data = oc_index_longer, aes(x = value)) +
  geom_histogram() +
  theme_minimal() +
  facet_grid(~sids_category)
```

```{r}
ggplot(data = oc_index_longer, aes(x = value, fill = sids_category)) +
  geom_histogram() +
  theme_minimal() +
  facet_wrap(~region)
```



Optional - Make a new column in oc_index_longer that indicates whether a ranking is a criminality score (low is good?) or a resillience score (high is good)



Heatmap 

```{r}
oc_index_sids <- oc_index %>% 
  filter(sids_category == "sids")
```


```{r}
oc_index_sids <- oc_index_sids %>% 
  select(-continent, -region, -country_code, -sids_category) 
```


```{r}
oc_index_sids_longer <- oc_index_sids %>% 
  pivot_longer(cols = criminality:non_state_actors,
               names_to = "measure",
               values_to = "value")

```





```{r}
#oc_index_sids_matrix <- as.matrix(oc_index_sids_longer)
```





```{r}
ggplot(data = oc_index_sids_longer, aes(x = measure,
                                        y = country,
                                        fill = value)) +
  geom_tile() +
  theme(axis.text.x = element_text(angle = 45, size = 6, vjust = 1, hjust = 1)) +
   scale_fill_gradient(low = "yellow", high = "red")
```




Correlation Matrix 

```{r}
oc_index_sids_corr <- oc_index_sids %>% 
  select(-country)
```

```{r}
corr <- oc_index_sids_corr %>% 
  cor()
```

```{r}
ggcorrplot(corr, hc.order = TRUE, type = "lower") +
  theme(axis.text.x = element_text(angle = 45, size = 6, vjust = 1, hjust = 1),
        axis.text.y = element_text(size = 6, vjust = 1, hjust = 1))
```

Andrew: Can you make this correlation plot for all countries in the oc index (eactly what we did above but for all countries instead of just sids)
